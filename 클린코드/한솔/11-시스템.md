11장. 시스템
==========

## 시스템 제작과 시스템 사용을 분리하라
- 시작, 준비 단계 / 런타임 로직을 분리해야 한다.
- 초기화 지연 혹은 계산 지연 기법
  ```
    public Service getService() {
      if(service == null) {
        service= new MyServiceImpl(...);
      }
      return service;
    }
  ```
  장점
  - 실제로 필요할 때까지 객체를 생성하지 않아 불필요한 부하가 걸리지 않는다.
  - null 포인터를 반환하지 않는다.
    
  단점
  - 런타임 로직에서 MyServiceImpl을 사용하지 않더라도 의존성을 해결하지 않으면 컴파일이 안된다.
  - MyServiceImpl이 무개운 객체의 경우 호출하기 전에 테스트할 전용 객체를 service에 할당해야 한다.
  - null인 경로와 아닌 경로 모두 테스트해야 한다.
- 설정 논리와 일반 실행 논리를 분리해야 모듈성이 높아진다.
  - 객체를 생성하거나 의존성을 연결할 때
 
#### Main 분리
- 시스템 생성과 사용을 분리
  - main이나 main을 호출하는 모듈: 시스템에 필요한 객체를 생성하여 애플리케이션에 넘긴다.
  - 나머지는 모든 객체가 생성되고 의존성이 연결되었다고 가정한다. 객체를 사용할 뿐이다.

#### 팩토리
- 주문 처리 시스템에서 
  - 애플리케이션은 LineItem 인스터스를 생성해 Order에 추가한다.
  - ABSTRACT FACTORY 패턴을 사용
  - LineItem을 생성하는 시점은 애플리케이션이 결정
  - 생성하는 코드는 main에서 LineItemFactoryImpl

#### 의존성 주입
- 사용과 제작을 분리하는 제어 역전 기법을 이용한 메커니즘
  -  IoC: 한 객체가 맡은 보조 책임을 새로운 객체에게 전력으로 떠넘긴다.
- 객체는 의존성 자체를 인스턴스로 만드는 책임은 지지 않는다. __main__이나 특수 컨테이너를 사용한다.
- JNDI 검색은 의존성 주입을 부분적으로 구현한 기능, 객체는 이름에 일치하는 서비스를 요청한다.
- 클래스는 수동적이다.
    - 설정자 메서드나 생성자 인수를 제공한다.
 - DI 컨테이너는 필요한 객체의 인스턴스를 만둔 후 생성자 인수나 설정자 메서드를 사용해 의존성을 설정한다.
     - 팩토리를 호출하거나 프록시를 생성하는 방법을 제공하여 객체를 생성한다.
     - 계산 지연 기법에서 사용한다.
 - 객체 사이의 의존성은 XML 파일에서 정의한다.

## 확장
- 주어진 사용자 스토리에 맞춰 시스템을 구현한다.
    - 오늘, 내일의 스토리에 맞춰 조정하고 확장한다.
 
#### 횡단 관심사
- 영속성은 애플리케이션의 객체 경계를 넘나든다.
    - 모든 객체가 동일한 방식을 이용하게 만들어야 한다.
- AOP에서 모듈 구성 개념은 "특정 관심사를 지원하려면 특정 지점들이 동작하는 방식을 일관성 있게 변경해야 한다."
    - 영속성으로 저장할 객체와 속성을 선언 -> 영속성 책임을 영속성 프레임워크에 위임 -> AOP 프레임워크는 대상 코드에 영향을 미치지 않는 상태로 동작 방식을 변경한다.
 
## 자바 프록시
- 단순한 상황에서 사용
  - 개별 객체나 클래스에서 메서드 호출을 감싸는 경우
- 시스템 단위로 실행 지점을 명시하는 메커니즘을 제공하지 않는다.

## 순수 자바 AOP 프레임워크
- POJO: 도메인에 초점을 맞춘다. 다른 도메인에 의존적이지 않음
    - Bank 객체는 DAO로 프록시되고, DAO 객체는 JDBC 드라이버 자료 소스로 프록시된다.
    - 애플리케이션은 스프링과 독립적이다.
- XML: 장황하지만 프록시보다 단순하다.

## AspectJ 관점
- 관심사를 관점으로 분리하는 도구

## 테스트 주도 시스템 아키텍처 구축
- 관점으로 관심사를 분리하는 방식은 테스트 주도 아키텍처 구축이 가능해진다.

## 의사 결정을 최적화하라
- 모듈을 나누고 관심사를 분리하면 지엽적인 관리와 결정이 가능하다.
- 최대한 정보를 모아 최선의 결정을 내리는 최후로 마루는 방법

## 명백한 가치가 있을 때 표준을 현명하게 사용하라
- 표준에 집착하지 말고 표준을 제정한 목적을 잊어버리지 말자

## 시스템은 도메인 특화 언어가 필요하다.
- DSL는 짠 코드는 도메인의 구조가 명확히 분리되어 추상화 수준이 높다.
